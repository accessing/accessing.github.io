<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<title>Testing</title>

	<link rel="stylesheet" href="/assets/common/reset.css" type="text/css"/>

	<style>		
		#raw, #rec {
			top: 0;
			left: 0;
			width: 50%;
			border: solid 1px white;
			position: absolute;
		}
		#rec {
			left: 50%;
		}
		div.item {
			border-bottom: solid 1px darkolivegreen;
		}
	</style>

    <script src="/assets/common/common.js"></script>
    <script src="/assets/common/jquery.js"></script>
    <script src="/assets/joy/joy.js"></script>
	<script src="recognizer.js"></script>
	<script src="touch.parsers.js"></script>
    <script>  
		function logq(id, q) {
			function text(item) {
				return item.act + ':' + item.rpos;
			}
			var el = $('#' + id)[0];
			el.innerHTML = '';
			for (var i = 0; i < q.length; i++) {
				var list = q[i];
				var div = document.createElement('div');
				div.className = 'item';
				el.appendChild(div);
				if (list instanceof Array) {
					for (var j = 0; j < list.length; j++) {
						var item = list[j];
						div.innerHTML += text(item);
					}
				} else {
					div.innerHTML += text(list);
				}
			}
		}
		$(function () {
			var target = document;
			var rel = document.body;
			var rg = Recognizer({
				mode: 1,
				rel: rel,
				capture: {
					region: rel.getBoundingClientRect(),
					qchanged: function (q) {
						logq('raw', q);
						//console.log('Capture ' + q);
					}
				}, recognizing: {
					qchanged: function (q) {
						logq('rec', q);
						//debugger;
						//console.log('Recognize ' + q);
					}
				}, parser: [zoomParser, dblTouchedParser, dragParser, singleTouchedParser]
			});

			$(target).mousemove(function (event) {
				//debugger;
				rg.parse([{ act: 'touchmove', pos: [event.clientX, event.clientY], rpos: [event.clientX, event.clientY], time: new Date() }]);
			});

			$(target).mousedown(function (event) {
				rg.parse([{ act: 'touchstart', pos: [event.clientX, event.clientY], rpos: [event.clientX, event.clientY], time: new Date() }]);
			});

			$(target).mouseup(function (event) {
				rg.parse([{ act: 'touchend', pos: [event.clientX, event.clientY], rpos: [event.clientX, event.clientY], time: new Date() }]);
			});
		});
    </script>
</head>
<body>

<div id="raw" class="z-bg"></div>
<div id="rec" class="z-bg"></div>
<div class="z-topmost crop noborder noselect .transparent fill-fixed">
</div>

</body>
</html>