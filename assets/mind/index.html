<!doctype html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<title>Idea</title>

	<link rel="stylesheet" href="//cdn.mindexpress.cn/assets/common/reset.css" type="text/css" />
	<link rel="stylesheet" href="//cdn.mindexpress.cn/assets/common/overlay.css" type="text/css" />
	<link rel="stylesheet" href="//cdn.mindexpress.cn/assets/mind/mind.css" type="text/css" />
	<link rel="stylesheet" href="//cdn.mindexpress.cn/assets/cells/cells.css" type="text/css" />
	<link rel="stylesheet" href="//cdn.mindexpress.cn/assets/common/toastr.css" type="text/css" />

	<style>

	</style>

	<script src="//cdn.mindexpress.cn/assets/common/common.js"></script>
	<script src="//cdn.mindexpress.cn/assets/common/upload.js"></script>
	<script src="//cdn.mindexpress.cn/assets/common/debug.js"></script>
	<script src="//cdn.mindexpress.cn/assets/common/jquery.js"></script>
	<script src="//cdn.mindexpress.cn/assets/joy/joy.js"></script>
	<script src="//cdn.mindexpress.cn/assets/joy/joy.dom.js"></script>
	<script src="//cdn.mindexpress.cn/assets/fingers/recognizer.js"></script>
	<script src="//cdn.mindexpress.cn/assets/fingers/touch.parsers.js"></script>
	<script src="//cdn.mindexpress.cn/assets/fingers/touch.js"></script>
	<script src="//cdn.mindexpress.cn/assets/transform/rotator.js"></script>
	<script src="//cdn.mindexpress.cn/assets/fingers/touchable.js"></script>
	<script src="//cdn.mindexpress.cn/assets/mind/scene.js"></script>
	<script src="//cdn.mindexpress.cn/assets/cells/cells.js"></script>
	<script src="//cdn.mindexpress.cn/assets/common/toastr.js"></script>
	<script>   
		$(function () {
			var scene = initscene({ id: 'scene' });

			document.oncontextmenu = function (event) {
				return false;
			};

			document.onkeyup = function(event) {
				if (event.keyCode == 46) {
					scene.delnode();
				}
			}

			window.title = $('#tname').val();
			document.title = $('#tname').val();

			$('#bload').click(function () {
				if (login) {
					toastr.info('Loading, please wait ...');
					get('/mr/load/' + $('#tname').val(), null, function(o) {
						if (o.success === false) {
							toastr.error(o.errormsg);
						} else {
							toastr.success('Load completed');
							console.log(o);
							scene.setval(o);
						}
					}, function(e) {
						toastr.error(e.responseText);
					});
				} else {
					toastr.info('You have not signed in yet, cannot continue');
				}
			});
			$('#bsave').click(function () {
				if (login) {
					var json = scene.getval();
					console.log(json);
					post('/mr/save', { fname: $('#tname').val(), text: json }, function(o) {
						if (!o.success) {
							toastr.error(o.errormsg);
						} else {
							toastr.success('Save completed');
						}
					});
				} else {
					toastr.info('You have not signed in yet, cannot continue');
				}
			});
			checklogin();
		});
		var login = false;
		function checklogin() {
			function setinfo(o) {
				login = true;
				$('#qqinfo').show();
				$('#qquid').html(o.result.name);
			}
			$('#bqqsignin').click(function () {
				get('://mindexpress.cn/qqlogin/verify', null, function (o) {
					if (o.success) {
						setinfo(o);
					} else {
						login = false;
						$('#bqqsignin').show();
					}
				});
				$('#bqqsignin').hide();
			});
			$('#bqqsignout').click(function () {
				get('://mindexpress.cn/qqlogin/signout', null, function (o) {
					login = false;
					$('#qqinfo').hide();
					$('#bqqsignin').show();
				});
			});
			get('://mindexpress.cn/qqlogin/check', null, function (o) {
				if (o.success) {
					setinfo(o);
				} else {
					login = false;
					$('#bqqsignin').show();
				}
			});
		}
	</script>
</head>
<body>
<img class="brand transparent-35" src="//cdn.mindexpress.cn/assets/mr/res/home_bg.png"/>
<div id="scene" class="scene">
</div>
<div class="fixed left-top idea-name">
	<input id="tname" type="text" value="Idea Name" />
</div>
<div class="assist left">
	<div class="btn" id="bload">Load</div>
	<div class="btn" id="bsave">Save</div>
</div>

<div class="login fixed align-right right-top">
	<a id="bqqsignin" style="display: none;" href="https://graph.qq.com/oauth2.0/authorize?response_type=code&client_id=101288663&redirect_uri=http://mindexpress.cn/qqlogin&scope=get_user_info" target="_blank">
		<img src="//cdn.mindexpress.cn/assets/account/img/Connect_logo_7.png" />
	</a>
	<div id="qqinfo" style="display:none;">Welcome&nbsp;<span id="qquid"></span>&nbsp;&nbsp;<a id="bqqsignout" href="#">Sign Out</a></div>
</div>
</body>
</html>