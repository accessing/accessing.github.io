<!doctype html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<title>Idea</title>

	<link rel="stylesheet" href="//cdn.mindexpress.cn/assets/common/reset.css" type="text/css" />
	<link rel="stylesheet" href="//cdn.mindexpress.cn/assets/common/overlay.css" type="text/css" />
	<link rel="stylesheet" href="//cdn.mindexpress.cn/assets/common/toastr.css" type="text/css" />

	<style>
		div * {
			color: white;
		}

		body {
			overflow: hidden;
			background: linear-gradient(#274289, #1e2b51); 
		}

		img.brand {
			position: fixed;
			left: 50%;
			top: 50%;
			width: 600px;
			height: 450px;
			margin-left: -300px;
			margin-top: -225px;
		}

		.scene {
			position: fixed;
			cursor: crosshair;

			background: none;
			border: solid 1px silver;
			background: none;
		}

		.scene svg {
			cursor: crosshair;
			width: 100%;
			height: 100%;
			background: none;
		}

		.scene svg path {
			color: silver;
			stroke: silver;
			fill: none;
		}

		.scene svg path.selected {
			color: white;
			stroke: white;
		}

		.scene .node {
			border-radius: 6px;
			position: absolute;
			padding: 0px 8px 0px 8px;
			text-align: left;
			background: #d77f3d;
			border: solid 1px #a52a2a;
		}
		.scene .node .content {
			line-height: 30px;
		}
		.scene .node, .scene .node .content {
			cursor: pointer;
			color: black;
		}


		.scene .node.selected {
			border: solid 2px white;
			line-height: 28px;
		}

		.scene .label {
			position: absolute;
			color: silver;
			cursor: pointer;
		}

		.scene .label.selected {
			color: white;
		}
		.assist {
			position: fixed;
			right: 0px;
			top: 50%;
			width: 48px;
			margin-top: -24px;
		}
		.assist.left {
			right: initial;
			left: 0px;
		}
		.assist .btn {
			font: 10px arial;
			line-height: 24px;
			color: black;
			text-align: center;
			padding: 4px;
			margin-top: 4px;
			cursor: pointer;

			border: solid 1px gray;
			background: silver;
		}
		.node-editor {
			position: absolute;
			top: 0px;
			left: 0px;
			bottom: 0px;
			right: 0px;
			padding: 4px;
		}
		.node-editor .bclose {
			position: absolute;
			right: 4px;
			top: 4px;
			width: 24px;
			height: 24px;
			border-radius: 12px;
			font: 12px arial;
			line-height: 24px;
			text-align: center;
			cursor: pointer;
			border: solid 1px silver;
			color: silver;
		}
		.node-editor .area {
			position: absolute;
			top: 12px;
			left: 12px;
			right: 12px;
			height: 80px;
			padding: 4px;
			width: 90%;
			overflow: auto;
			white-space: pre-line;
			border-bottom: solid 1px silver;
		}
		.node-editor .bsave {
			position: absolute;
			bottom: 12px;
			right: 12px;
			padding: 4px;
			border: solid 1px gray;
			background: silver;
			color: black;
		}
		.idea-name {
			padding: 4px;
		}
		.idea-name input[type=text] {
			border-bottom: solid 1px silver;
		}
	</style>

	<script src="//cdn.mindexpress.cn/assets/common/common.js"></script>
	<script src="//cdn.mindexpress.cn/assets/common/upload.js"></script>
	<script src="//cdn.mindexpress.cn/assets/common/debug.js"></script>
	<script src="//cdn.mindexpress.cn/assets/common/jquery.js"></script>
	<script src="//cdn.mindexpress.cn/assets/joy/joy.js"></script>
	<script src="//cdn.mindexpress.cn/assets/joy/joy.dom.js"></script>
	<script src="//cdn.mindexpress.cn/assets/fingers/recognizer.js"></script>
	<script src="//cdn.mindexpress.cn/assets/fingers/touch.parsers.js"></script>
	<script src="//cdn.mindexpress.cn/assets/fingers/touch.js"></script>
	<script src="//cdn.mindexpress.cn/assets/transform/rotator.js"></script>
	<script src="//cdn.mindexpress.cn/assets/fingers/touchable.js"></script>
	<script src="//cdn.mindexpress.cn/assets/mind/scene.js"></script>
	<script src="//cdn.mindexpress.cn/assets/common/toastr.js"></script>
	<script>   
		$(function () {
			var scene = initscene({ id: 'scene' });

			document.oncontextmenu = function (event) {
				return false;
			};

			document.onkeyup = function(event) {
				if (event.keyCode == 46) {
					scene.delnode();
				}
			}

			window.title = $('#tname').val();
			document.title = $('#tname').val();

			$('#bload').click(function () {
				toastr.info('Loading, please wait ...');
				get('/mr/load/' + $('#tname').val(), null, function (o) {
					toastr.clear();
					if (o.success) {
						toastr.success('Load completed');
						console.log(o);
						scene.setval(o);
					} else {
						toastr.error(o.errormsg);
					}
				}, function (e) {
					toastr.error(e.responseText);
				});
			});
			$('#bsave').click(function () {
				var json = scene.getval();
				console.log(json);
				post('/mr/save', { fname: $('#tname').val(), text: json }, function (o) {
					if (!o.success) {
						toastr.error(o.errormsg);
					} else {
						toastr.success('Save completed');
					}
				});
			});

		});
	</script>
</head>
<body>
<img class="brand transparent-35" src="//cdn.mindexpress.cn/assets/mr/res/home_bg.png"/>
<div id="scene" class="scene">
</div>
<div class="fixed left-top idea-name">
	<input id="tname" type="text" value="Idea Name" />
</div>
<div class="assist left">
	<div class="btn" id="bload">Load</div>
	<div class="btn" id="bsave">Save</div>
</div>
</body>
</html>