function acts(n,t){return(!n,!n.indexOf&&n.act?n=n.act:!n.indexOf,n.indexOf(t)==0)?!0:!1}function Recognizer(n){function i(n){var r=n,u=t[n.q],f,i;if(u.length>=r.step[0]){if(r.point)for(f=u.length-r.step[1];f<u.length;f++)if((i=u[f],i)&&(i.length<r.point[0]||i.length>r.point[1]))return i&&i.length>0?console.log(i[0].act+" point mismatch"):console.log("Point condition failed"),!1;return!0}return!1}function r(n){for(var r,f,e=t[0],o=t[1],u=0;u<n.parser.length;u++)if(r=n.parser[u](),r.condition){if((typeof r.condition=="function"&&r.condition(t)||i(r.condition))&&(f=r.verify(t),f)){o.add(f);e.clear();n.recognizing&&n.recognizing.qchanged&&n.recognizing.qchanged(o);n.capture&&n.capture.qchanged&&n.capture.qchanged(e);break}}else console.log("Checked "+r.condition)}var t=[[],[]];return n||(n={}),n.parser||console.log("Parser missing for recognizer"),{parse:function(i){var u,e,f,o;n.parser&&(u=n,u.capture&&u.capture.parse&&u.capture.parse(i),e=u.iqlen||8,f=t[0],f.add(i),f.length>e&&f.splice(0,1),o=t[1],o.length>e&&o.splice(0,1),u.capture&&u.capture.qchanged&&u.capture.qchanged(f),r(u))}}}function zoomParser(){function n(n,t){var i=n[0],r=t[0],u=n[1],f=t[1];return(x=r-i,y=f-u,hypotenuse=Math.sqrt(Math.pow(x,2)+Math.pow(y,2)),cos=x/hypotenuse,radian=Math.acos(cos),x==0||radian==0)?0:(angle=180/(Math.PI/radian),y<0?angle=-angle:y==0&&x<0&&(angle=180),angle)}function t(t){var i=t[0],r=t[1],u=i.rpos,f=r.rpos,s=[(i.pos[0]+r.pos[0])/2,(i.pos[1]+r.pos[1])/2],h=[(i.rpos[0]+r.rpos[0])/2,(i.rpos[1]+r.rpos[1])/2],e=u[0]-f[0],o=u[1]-f[1],c=Math.sqrt(e*e+o*o),l=n(u,f);return{pos:s,rpos:h,len:c,angle:l,xlen:Math.abs(e),ylen:Math.abs(o)}}return{condition:{q:0,step:[1,1],point:[1,2]},verify:function(n){var f=n[0],e=n[1];if(!f||!e)return console.log("q / oq undefined [pin]"),!1;var r=f.last(1),u=e.last(1),i=r.length==2?t(r):r[0];if(!i.rpos,r.length==1&&u&&(acts(u,"zooming")||acts(u,"zoomstart")))return{act:"zoomend",pos:i.pos,rpos:i.rpos,time:new Date,len:i.len,angle:i.angle,xlen:i.xlen,ylen:i.ylen};if(r.length==2&&(acts(r[0],"touchend")||acts(r[1],"touchend")))return{act:"zoomend",pos:i.pos,rpos:i.rpos,time:new Date,len:i.len,angle:i.angle,xlen:i.xlen,ylen:i.ylen};if(r.length!=2||u&&(acts(u,"zooming")||acts(u,"zoomstart"))){if(r.length==2)return{act:"zooming",pos:i.pos,rpos:i.rpos,time:new Date,len:i.len,angle:i.angle,xlen:i.xlen,ylen:i.ylen}}else return{act:"zoomstart",pos:i.pos,rpos:i.rpos,time:new Date,len:i.len,angle:i.angle,xlen:i.xlen,ylen:i.ylen};return!1}}}function singleTouchedParser(){return{condition:{q:0,step:[2,3],point:[1,1]},verify:function(n,t,i){var r=n[0];if(!r)return console.log("q undefined"),!1;t||(t=0);i||(i=r.length-1);var f=r[i-2]?r[i-2][0]:null,e=r[i-1][0],u=r[i][0];return(f||(f=e),acts(f.act,"touchstart")&&(acts(u.act,"touchend")||acts(e.act,"touchend"))||acts(e.act,"touchstart")&&acts(u.act,"touchend"))?{act:"touched",pos:u.pos,rpos:u.rpos,time:new Date}:!1}}}function dragParser(){return{condition:{q:0,step:[1,2],point:[1,1]},verify:function(n,t,i){var e=n[0],o=n[1];if(!e||!o)return console.log("q / oq undefined"),!1;t||(t=0);i||(i=e.length-1);var u=e.length==1?null:e[i-1][0],r=e[i][0],f=o[o.length-1];return acts(r.act,"touchend")&&f&&(acts(f.act,"dragging")||acts(f.act,"dragstart"))?{act:"dropped",pos:r.pos,rpos:r.rpos,time:new Date}:u&&acts(u.act,"touchstart")&&acts(r.act,"touchmove")?{act:"dragstart",pos:r.pos,rpos:r.rpos,time:new Date}:u&&f&&acts(u.act,"touchmove")&&(acts(f.act,"dragstart")||acts(f.act,"dragging"))?{act:"dragging",pos:r.pos,rpos:r.rpos,time:new Date}:u&&acts(u.act,"touchmove")&&acts(r.act,"touchend")?{act:"dropped",pos:r.pos,rpos:r.rpos,time:new Date}:!1}}}function dblTouchedParser(){return{condition:{q:0,step:[2,2],point:[1,1]},verify:function(n,t,i){var u=singleTouchedParser(),f,r;if(u=u.verify(n,t,i),u){if((f=n[1],!f||f.length<1)||(i||(i=f.length-1),r=f[i],!r))return!1;var e=u.time,o=r.time,s=o.diff(e);return s<400&&acts(u.act,"touched")&&acts(r.act,"touched")?{act:"dbltouched",pos:r.pos,rpos:r.rpos,time:new Date}:!1}return!1}}}function touch(n){function h(n,t){function e(n,t){if(t.act.indexOf("touch")>=0){var r=14,i=document.createElement("div");i.style.position="absolute";i.style.left=t.rpos[0]-r+"px";i.style.top=t.rpos[1]-r+"px";i.style.width=r*2+"px";i.style.height=r*2+"px";i.style.borderRadius=r+"px";i.style.border="solid 3px silver";i.style.background="none";i.$evtignore$=!0;n.appendChild(i)}}var i=null,u,r,f,o;if(n.$touches$?(i=n.$touches$,i.innerHTML=""):(i=document.createElement("div"),n.$touches$=i,n.appendChild(i)),t)if(t instanceof Array)for(u=0;u<t.length;u++)if(r=t[u],r instanceof Array)for(f=0;f<r.length;f++)o=r[f],e(i,o);else e(i,r);else e(i,t)}function c(){var n={};return n.opos=[0,0],n.pos=[0,0],n.fpos=[0,0],n.origin=function(n){this.opos=[n[0],n[1]];this.fpos=[n[0],n[1]];this.pos=[n[0],n[1]]},n.update=function(n,t){t?(t=[n[0]-this.pos[0],n[1]-this.pos[1]],this.opos[0]+=t[0],this.opos[1]+=t[1]):t=[0,0];this.pos=[n[0],n[1]];this.flip()},n.flip=function(){var n=this.opos,t=this.pos,i=[n[0]*2-t[0],n[1]*2-t[1]];return this.fpos=i,i},n.offset,n}function o(n){try{var t=n.touches;return t&&t.length!=0||(t=n.targetTouches),t&&t.length!=0||(t=n.changedTouches),t}catch(i){return alert(i),[]}}function s(n,t,i){for(var o,l,a,r=[],u=0;u<t.length;u++){var s=t[u],f=s.clientX,e=s.clientY,h=f,c=e;i.rel&&(o=i.rel.getBoundingClientRect(),h=f-o.left,c=e-o.top);l=new Date;a={act:n,pos:[f,e],rpos:[h,c],time:l};r[r.length]=a}return r}var u={},e;n||(n={});var l=n.target,f=n.rel,i=c(),r=Recognizer({mode:1,rel:f,capture:{region:f.getBoundingClientRect(),parse:function(t){n.showtouch&&h(document.body,t)},qchanged:function(n){for(var t,e,f,i={},r=0;r<n.length;r++)t=n[r],!t.processed&&u[t.act]&&(i[t.act]||(i[t.act]=[]),e=i[t.act],e.add(t)),t.processed=!0;for(f in i)u[f](i[f])}},recognizing:{qchanged:function(n){for(var t,i=0;i<n.length;i++)t=n[i],!t.processed&&u[t.act]&&u[t.act](t),t.processed=!0}},parser:[zoomParser,dblTouchedParser,dragParser,singleTouchedParser]}),t=$(l)[0];return t.md=!1,t.zooming=!1,isMobile.any()||(t.onmousemove=function(n){t.zooming?(i.update([n.clientX,n.clientY],t.of),r.parse([{act:"touchmove",pos:[n.clientX,n.clientY],rpos:[n.clientX,n.clientY],time:new Date},{act:"touchmove",pos:i.fpos,rpos:i.fpos,time:new Date}])):t.md?r.parse([{act:"touchmove",pos:[n.clientX,n.clientY],rpos:[n.clientX,n.clientY],time:new Date}]):r.parse([{act:"mousemove",pos:[n.clientX,n.clientY],rpos:[n.clientX,n.clientY],time:new Date}])},t.onmousedown=function(n){if(t.md=!0,n.button==0)t.zooming=!1,r.parse([{act:"touchstart",pos:[n.clientX,n.clientY],rpos:[n.clientX,n.clientY],time:new Date}]);else{t.zooming=!0;n.button==1?(t.of=!0,n.preventDefault()):t.of=!1;var u=document.body.getBoundingClientRect();i.origin([u.width/2,u.height/2]);i.update([n.clientX,n.clientY]);r.parse([{act:"touchstart",pos:i.pos,rpos:i.pos,time:new Date},{act:"touchstart",pos:i.fpos,rpos:i.fpos,time:new Date}])}},t.onmouseup=function(n){t.md=!1;t.zooming=!1;t.of=!1;r.parse([{act:"touchend",pos:[n.clientX,n.clientY],rpos:[n.clientX,n.clientY],time:new Date}])}),e=t,e.ontouchstart=function(n){var t=o(n),i=s("touchstart",t,{rel:f});r.parse(i);n.stopPropagation();isSafari},e.ontouchmove=function(n){var t=o(n),i=s("touchmove",t,{rel:f});r.parse(i);n.stopPropagation();isSafari&&n.preventDefault()},e.ontouchend=function(n){var t=o(n),i=s("touchend",t,{rel:f});r.parse(i);n.stopPropagation();isSafari},{on:function(n){for(var t in n)u[t]=n[t]}}}function Rotator(n){function t(n){var i=n.getBoundingClientRect(),t;return n.style.left=n.astyle(["left"]),n.style.top=n.astyle(["top"]),n.style.width||(n.style.width=n.astyle(["width"])),n.style.height||(n.style.height=n.astyle(["height"])),n.$rot$={origin:{center:[i.width/2,i.height/2],angle:0,scale:[1,1],pos:[parseFloat(n.style.left),parseFloat(n.style.top)],sz:[parseFloat(n.style.width),parseFloat(n.style.height)]},cmt:{center:[i.width/2,i.height/2],angle:0,scale:[1,1],pos:[parseFloat(n.style.left),parseFloat(n.style.top)],sz:[parseFloat(n.style.width),parseFloat(n.style.height)]},cache:{center:[i.width/2,i.height/2],angle:0,scale:[1,1],pos:[parseFloat(n.style.left),parseFloat(n.style.top)],sz:[parseFloat(n.style.width),parseFloat(n.style.height)]},status:[]},n.getcenter=function(){return this.$center$.getBoundingClientRect()},n.pushStatus=function(){var r=this.getcenter(),u=[parseFloat(this.style.left),parseFloat(this.style.top)],n={center:[r.left,r.top],pos:u},t=this.$rot$.status,i=t.length>0?t[t.length-1]:n;return n.delta={center:[n.center[0]-i.center[0],n.center[1]-i.center[1]],pos:[n.pos[0]-i.pos[0],n.pos[1]-i.pos[1]]},t[t.length]=n,t.length>6&&(this.$rot$.status=t.splice(0,1)),n},n.origin=function(n){this.style.transformOrigin=n[0]+"px "+n[1]+"px"},n.correct=function(n,t){t||(t=[0,0]);var i=this,r=n.delta,u=parseFloat(i.style.left)-r.center[0],f=parseFloat(i.style.top)-r.center[1];return i.$rot$.offset=[t[0]+r.center[0],t[1]+r.center[1]],i.style.left=u+"px",i.style.top=f+"px",i.$rot$.offset},n.commitStatus=function(){var n=this.$rot$;n.cmt=this.$rot$.cache;n.cmt.pos=[parseFloat(this.style.left),parseFloat(this.style.top)];n.cmt.sz=[parseFloat(this.style.width),parseFloat(this.style.height)];n.cache={angle:0,scale:[1,1],pos:[0,0],sz:[0,0]};n.offset=[0,0]},n.rotate2=function(n,t){var l,h;if(!n)return this;var i=this.$rot$.cache,r=this.$rot$.cmt,u=this.$rot$.offset,o=n.angle,c=n.center,f=n.scale,s=n.pos,e=n.resize;return u||(u=[0,0]),c!==t&&(this.pushStatus(),this.origin(c),l=this.pushStatus(),u=this.correct(l,u)),(o||o===0)&&(i.angle=r.angle+o,i.angle=i.angle%360),e&&(i.sz=[r.sz[0]+e[0],r.sz[1]+e[1]],i.sz[0]<10&&(i.sz[0]=10),i.sz[1]<10&&(i.sz[1]=10)),f&&(f instanceof Array||(h=parseFloat(f),f=[h,h]),i.scale=[r.scale[0]*f[0],r.scale[1]*f[1]]),s&&(i.pos=[r.pos[0]+s[0]-u[0],r.pos[1]+s[1]-u[1]]),this.style.transform="rotateZ("+i.angle+"deg) scale("+i.scale[0]+","+i.scale[1]+")",this.style.left=i.pos[0]+"px",this.style.top=i.pos[1]+"px",e&&(this.style.width=i.sz[0]+"px",this.style.height=i.sz[1]+"px"),this.pushStatus(),this},n.rotate=function(n,t){var u,h,e;if(!n)return this;var o=n.angle,s=n.center,i=n.scale,f=n.offset,r=this,c=r.$rot$.origin.angle;return i===t?i=[1,1]:i instanceof Array||(u=parseFloat(i),u==0&&u==.001,i=[u,u]),s!==t&&(this.pushStatus(),this.origin(s),h=this.pushStatus(),this.correct(h)),o!==t&&(e=(o+c)%360,r.style.transform="rotateZ("+e+"deg) scale("+i[0]+","+i[1]+")",r.$rot$.origin.angle=e),f&&(r.style.left=parseFloat(r.style.left)+f[0]+"px",r.style.top=parseFloat(r.style.top)+f[1]+"px"),this.pushStatus(),this},n.$center$||(t=document.createElement("div"),t.style.position="absolute",t.style.left="50%",t.style.top="50%",t.style.width="0px",t.style.height="0px",t.style.border="solid 0px blue",n.appendChild(t),n.$center$=t,n.origin(n.$rot$.origin.center),n.style.transform="rotate(0deg)",n.pushStatus()),n}return t(n)}(function(){function t(n){var t=[0,0];return t[0]=n.offsetX,t[1]=n.offsetY,t}function n(){var n=window.$touchTarget$;return n.$target$&&(n=n.$target$()),n}function i(n){window.$touchTarget$=n}function f(u,f){function s(n,t){if(t&&t.istouchable&&t.istouchable()){o(n);var r=t.$target$?t.$target$():t,u=r.$tcfg$,f=r.$rel$;u.touched&&u.touched(n,t)||(i(t),h({pos:n.pos},r),c[r.$mode$](n,r),r.commitStatus())}}function h(n,i){var u=i.getBoundingClientRect(),r=n,f=[r.pos[0]-u.left,r.pos[1]-u.top];i.$og$=r;i.onmouseover=function(n){f=t(n)};simulate(i,"mouseover",r.pos);i.$cpt$=f}function a(n,t){var u=t.$tcfg$,r=t.$og$,f=t.$cpt$,i;r&&(i={pos:[n.pos[0]-r.pos[0],n.pos[1]-r.pos[1]],len:n.len/r.len,angle:n.angle-r.angle},u.norotate&&(i.angle=0),t.rotate2({angle:i.angle,pos:i.pos,scale:[i.len,i.len],center:f}))}function v(n,t){var r=t.$og$,f=t.$cpt$,i,u;r&&(i={pos:[n.pos[0]-r.pos[0],n.pos[1]-r.pos[1]],len:n.len-r.len,angle:0,xlen:n.xlen-r.xlen,ylen:n.ylen-r.ylen},u=i.xlen||i.ylen?[i.xlen,i.ylen]:null,t.rotate2({angle:i.angle,pos:i.pos,resize:u,center:f}),t.zchange&&t.zchange(n))}function o(i){var r=n();return r.onmouseover=function(n){i.rpos=t(n)},simulate(r,"mouseover",i.pos),i}var c={zooming:a,zsizing:v},l,e;if(u){f||(f={rel:document.body});l=u;u.$evtrap$=!0;u.$mode$=f.mode||"zooming";u.istouchable=function(){return this.$mode$};u.$target$&&(u=u.$target$());u.$mode$=f.mode||"zooming";Rotator(u);u.$rel$=f.rel;u.$tcfg$=f;u.$og$=null;u.$cpt$=[0,0];i(l);touch({target:document,rel:f.rel||document.body}).on({touched:function(n){console.log(n);var t=r(n);s(n,t)},dbltouched:function(n){var t=r(n);t.$target$&&(t=t.$target$());t&&t.istouchable()&&(o(n),f.dbltouched&&f.dbltouched(n))},zoomstart:function(t){o(t);var i=n();i&&h(t,i)},zooming:function(t){o(t);var i=n();i&&c[i.$mode$](t,i)},zoomend:function(t){o(t);var i=n();i&&i.commitStatus()}});f.activate&&(e=u.getBoundingClientRect(),s({act:"touched",pos:[e.left+e.width/2,e.top+e.height/2],rpos:[e.width/2,e.height/2],time:new Date},u))}}function r(n){for(var r=[],t=null,i;;){if(t=document.elementFromPoint(n.pos[0],n.pos[1]),t.tagName.toLowerCase()=="body"||t.tagName.toLowerCase()=="html")break;if(!t.$evtignore$&&(t.$evtrap$||t.getAttribute("evtrap")))break;else r.add(t),$(t).hide()}for(i=0;i<r.length;i++)$(r[i]).show();return t}function e(n,i){var r=[];return i.onmouseover=function(n){var i=t(n);r[0]=i[0];r[1]=i[1]},simulate(i,"mouseover",n),r}window.getrpos=e;window.bypos=r;window.touchable=f;window.touchtarget=i})();